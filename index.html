<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casho Store</title>
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #818CF8;
            --background: #F8FAFC;
            --text: #1E293B;
            --success: #34D399;
            --error: #F87171;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .controls button {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            margin-left: 10px;
            cursor: pointer;
            transition: 0.3s;
        }

        .products-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 3px solid var(--primary);
        }

        .product-info {
            padding: 1rem;
        }

        .product-title {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .product-price {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .add-to-cart-btn {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1rem;
        }

        .add-to-cart-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .image-upload {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .preview-image {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
            margin-top: 1rem;
            display: none;
        }

        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: white;
            transition: 0.3s;
            z-index: 200;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .cart-open {
            right: 0;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .back-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
        }

        .admin-panel {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            display: none;
        }

        .phone-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #E2E8F0;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .cart-summary {
            padding: 1rem 0;
            border-top: 2px solid #eee;
            margin-top: 1rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
        }

        .total-price {
            font-weight: 700;
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .products-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">Casho Store</div>
            <div class="controls">
                <button onclick="toggleAdminPanel()">ÿßŸÑŸÖÿ¥ÿ±ŸÅ</button>
                <button onclick="toggleCart()">üõí ÿßŸÑÿ≥ŸÑÿ©</button>
            </div>
        </div>
    </header>

    <main class="products-container" id="productsContainer"></main>

    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2>ÿ≥ŸÑÿ© ÿßŸÑÿ™ÿ≥ŸàŸÇ</h2>
            <button class="back-btn" onclick="toggleCart()">ÿ±ÿ¨Ÿàÿπ</button>
        </div>
        <input type="tel" class="phone-input" placeholder="ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ" id="phoneNumber" required>
        <div id="cartItems"></div>
        
        <div class="cart-summary">
            <div class="summary-item">
                <span>ÿßŸÑŸÖÿ¨ŸÖŸàÿπ:</span>
                <span id="subtotal">$0.00</span>
            </div>
            <div class="summary-item">
                <span>ÿßŸÑÿ™ŸàÿµŸäŸÑ:</span>
                <span>$4.00</span>
            </div>
            <div class="summary-item total-price">
                <span>ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:</span>
                <span id="total">$4.00</span>
            </div>
        </div>
        
        <button class="add-to-cart-btn" onclick="sendOrder()">ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®</button>
    </div>

    <div class="admin-panel" id="adminPanel">
        <h2>ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</h2>
        <form class="admin-form" onsubmit="addProduct(event)">
            <div class="image-upload">
                <input type="file" id="productImage" accept="image/*" required>
                <label for="productImage">ÿßŸÜŸÇÿ± ŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿµŸàÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨</label>
                <img id="imagePreview" class="preview-image">
            </div>
            <input type="text" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨" required>
            <input type="number" placeholder="ÿßŸÑÿ≥ÿπÿ±" step="0.01" required>
            <input type="number" placeholder="ÿßŸÑŸÉŸÖŸäÿ©" required>
            <input type="number" placeholder="ÿßŸÑÿÆÿµŸÖ (%)">
            <button type="submit" class="add-to-cart-btn">ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨</button>
        </form>
        <div id="adminProducts"></div>
    </div>

<script>
let products = JSON.parse(localStorage.getItem('products')) || [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let isAdmin = false;

// ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ© ÿ•ŸÑŸâ Base64
function toBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}

async function addProduct(e) {
    e.preventDefault();
    const formElements = e.target.elements;
    const imageFile = document.getElementById('productImage').files[0];
    
    if (!imageFile) {
        alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸàÿ±ÿ© ŸÑŸÑŸÖŸÜÿ™ÿ¨');
        return;
    }

    try {
        const base64Image = await toBase64(imageFile);
        
        const newProduct = {
            id: Date.now(),
            name: formElements[1].value,
            price: parseFloat(formElements[2].value).toFixed(2),
            quantity: parseInt(formElements[3].value),
            discount: parseInt(formElements[4].value) || 0,
            image: base64Image
        };

        products.push(newProduct);
        saveToLocal();
        renderProducts();
        e.target.reset();
        document.getElementById('imagePreview').style.display = 'none';
    } catch (error) {
        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©');
    }
}

function renderProducts() {
    const container = document.getElementById('productsContainer');
    container.innerHTML = products.map(product => `
        <div class="product-card">
            <img src="${product.image}" class="product-img">
            <div class="product-info">
                <h3 class="product-title">${product.name}</h3>
                <p class="product-price">
                    $${product.price}
                    ${product.discount ? `<span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--error')}">(${product.discount}% ÿÆÿµŸÖ)</span>` : ''}
                </p>
                <p>ÿßŸÑŸÉŸÖŸäÿ©: ${product.quantity}</p>
                <button 
                    class="add-to-cart-btn" 
                    onclick="addToCart(${product.id})" 
                    ${product.quantity <= 0 ? 'disabled' : ''}
                >
                    ${product.quantity <= 0 ? 'ŸÜŸÅÿ∞ÿ™ ÿßŸÑŸÉŸÖŸäÿ©' : 'ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ≥ŸÑÿ©'}
                </button>
                ${isAdmin ? `<button style="margin-top:0.5rem;" onclick="deleteProduct(${product.id})">ÿ≠ÿ∞ŸÅ</button>` : ''}
            </div>
        </div>
    `).join('');
}

function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    if(product && product.quantity > 0) {
        cart.push({...product});
        product.quantity--;
        saveToLocal();
        renderProducts();
        updateCart();
    }
}

function calculateTotals() {
    const subtotal = cart.reduce((sum, item) => sum + parseFloat(item.price), 0);
    const delivery = 4;
    const total = subtotal + delivery;
    
    return {
        subtotal: subtotal.toFixed(2),
        total: total.toFixed(2)
    };
}

function updateCart() {
    const cartItems = document.getElementById('cartItems');
    cartItems.innerHTML = cart.map(item => `
        <div style="padding:1rem; border-bottom:1px solid #eee;">
            ${item.name} - $${item.price}
        </div>
    `).join('');
    
    const totals = calculateTotals();
    document.getElementById('subtotal').textContent = `$${totals.subtotal}`;
    document.getElementById('total').textContent = `$${totals.total}`;
}

function sendOrder() {
    const phoneNumber = document.getElementById('phoneNumber').value;
    if(!phoneNumber) return alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ');
    if(cart.length === 0) return alert('ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©!');
    
    const totals = calculateTotals();
    
    const message = `ÿ∑ŸÑÿ®Ÿäÿ© ÿ¨ÿØŸäÿØÿ© ŸÖŸÜ ŸÉÿßÿ¥Ÿà ÿ≥ÿ™Ÿàÿ± üõçÔ∏è%0A%0Aüì± ÿßŸÑÿ±ŸÇŸÖ: ${phoneNumber}%0A%0Aüìã ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™:%0A${cart.map(item => 
        `‚ñ´Ô∏è ${item.name} - $${item.price}`
    ).join('%0A')}%0A%0Aüíµ ÿßŸÑŸÖÿ¨ŸÖŸàÿπ: $${totals.subtotal}%0Aüöö ÿßŸÑÿ™ŸàÿµŸäŸÑ: $4.00%0Aüí∞ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÉŸÑŸä: $${totals.total}`;
    
    window.location.href = `https://wa.me/%2B96103447482?text=${message}`;
    cart = [];
    saveToLocal();
    updateCart();
}

function toggleAdminPanel() {
    const password = prompt('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±:');
    if(password === '1234') {
        isAdmin = true;
        document.getElementById('adminPanel').style.display = 'block';
        renderProducts();
    } else {
        alert('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿÆÿßÿ∑ÿ¶ÿ©!');
    }
}

function deleteProduct(productId) {
    if(!confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨ÿü')) return;
    products = products.filter(p => p.id !== productId);
    saveToLocal();
    renderProducts();
}

function saveToLocal() {
    localStorage.setItem('products', JSON.stringify(products));
    localStorage.setItem('cart', JSON.stringify(cart));
}

document.getElementById('productImage').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('imagePreview');
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
});

function toggleCart() {
    document.getElementById('cartSidebar').classList.toggle('cart-open');
}

function init() {
    renderProducts();
    updateCart();
}
init();
</script>
</body>
</html>
